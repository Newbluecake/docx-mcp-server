---
feature: i18n-support
complexity: standard
generated_by: clarify
generated_at: 2026-01-21T17:00:00Z
version: 1
---

# 需求文档: 界面国际化支持 (i18n)

> **功能标识**: i18n-support
> **复杂度**: standard
> **生成方式**: clarify
> **生成时间**: 2026-01-21

## 1. 概述

### 1.1 一句话描述
为 `DocxServerLauncher` 添加基于 Qt 原生机制的国际化支持，并将默认界面语言本地化为中文。

### 1.2 核心价值
- **用户体验**: 消除语言障碍，使中文用户能更直观地使用启动器。
- **可扩展性**: 建立标准的 i18n 架构，未来可轻松添加其他语言支持。

### 1.3 目标用户
- **主要用户**: 需要使用中文界面的国内用户。

---

## 2. 需求与用户故事

### 2.1 需求清单

| ID | 需求点 | 优先级 | 用户故事 |
|----|--------|--------|----------|
| R-001 | 字符串提取 | P0 | 作为开发者，我希望所有界面文本都使用 `tr()` 包裹，以便工具能提取待翻译字符串。 |
| R-002 | 翻译资源生成 | P0 | 作为开发者，我希望生成 `.ts` 文件并编译为 `.qm` 文件，以便应用加载翻译。 |
| R-003 | 中文翻译实现 | P0 | 作为用户，我希望看到“Working Directory”显示为“工作目录”，以便理解界面。 |
| R-004 | 翻译加载机制 | P0 | 作为用户，我希望应用启动时自动加载中文翻译文件，以便直接看到中文界面。 |

### 2.2 验收标准

#### R-001: 字符串提取
- **WHEN** 检查代码, **THEN** 所有 UI 相关的字符串（如 Window Title, Label, Button Text, Tooltip）均应使用 `self.tr("Text")` 或 `QCoreApplication.translate(...)` 包裹。

#### R-002: 翻译资源生成
- **WHEN** 运行 `pylupdate6` (或相关工具), **THEN** 应生成包含所有提取字符串的 `.ts` 文件。
- **WHEN** 运行 `lrelease`, **THEN** 应生成有效的 `.qm` 二进制文件。

#### R-003: 中文翻译实现
- **WHEN** 打开 `.ts` 文件, **THEN** 关键 UI 元素（Start Server, Browse, Logs 等）应有对应的中文翻译。

#### R-004: 翻译加载机制
- **WHEN** 启动应用, **THEN** `QTranslator` 应被安装，且界面文本显示为中文。

---

## 3. 功能验收清单

| ID | 功能点 | 验收步骤 | 优先级 | 关联需求 | 通过 |
|----|--------|----------|--------|----------|------|
| F-001 | 界面汉化 | 1. 启动 Launcher<br>2. 检查标题是否为“Docx MCP 服务器启动器”<br>3. 检查按钮是否为“浏览...”、“启动服务器” | P0 | R-003, R-004 | ☐ |
| F-002 | 动态文本 | 1. 启动服务器<br>2. 检查状态标签变为“状态：运行中”<br>3. 检查按钮变为“停止服务器” | P0 | R-001 | ☐ |
| F-003 | 对话框汉化 | 1. 点击“注入配置...”<br>2. 检查弹出的确认框内容是否为中文 | P1 | R-001 | ☐ |

---

## 4. 技术约束

### 4.1 技术栈
- **框架**: PyQt6
- **工具链**: `pylupdate6` (提取), `lrelease` (编译) - 需确认开发环境是否包含或需安装 `pyqt6-tools`。
- **文件格式**: Qt Linguist `.ts` (XML) -> `.qm` (Binary)

### 4.2 集成点
- **main.py**: 需要在 `QApplication` 初始化后、窗口显示前加载 `QTranslator`。
- **资源路径**: `.qm` 文件应放置在 `resources/translations/` 或类似目录，并确保打包时包含。

---

## 5. 排除项

- **动态切换语言**: 本次迭代仅需启动时加载中文，无需在界面上提供“切换语言”的下拉菜单（重启生效或即时生效均不作为硬性要求，默认加载中文即可）。
- **非 UI 文本**: 纯控制台日志（如 `server.py` 内部的 print）暂不强制汉化，仅汉化 GUI 模块产生的日志。

---

## 6. 下一步

✅ 在新会话中执行：
```bash
/clouditera:dev:spec-dev i18n-support --skip-requirements
```
