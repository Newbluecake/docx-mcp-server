# 需求分析: Context Aware Return

## 1. 背景与目标
目前的 MCP 工具主要返回人类可读的字符串消息。虽然这对单步操作很有用，但在自动化脚本或 Agent 连续操作（Chaining）时，缺乏结构化的上下文信息（如新创建对象的 ID、当前光标位置等）。

本功能旨在增强核心工具的返回值，使其不仅包含人类可读消息，还包含结构化的上下文数据，以便 Agent 能更精准地进行后续操作。

## 2. 核心需求

### R-001: 统一返回结构
所有修改文档状态的工具应返回统一的结构化数据（JSON 格式），包含：
- `status`: 操作状态
- `message`: 人类可读消息
- `data`: 操作产生的关键数据（如 `element_id`, `cursor_position`）

### R-002: 关键工具增强
以下类别的工具需要增强返回值：
- **创建类** (`add_paragraph`, `add_table`, `add_run`): 必须返回新对象的 ID。
- **光标类** (`cursor_move`, `insert_*`): 必须返回更新后的光标位置信息。
- **编辑类** (`update_*`, `set_*`): 返回受影响对象的 ID 和新状态摘要。

### R-003: 向后兼容
增强后的返回值必须保持与现有 MCP 协议的兼容性。文本部分应保留在 `content` 列表的 `text` 类型中，结构化数据可以通过嵌入 JSON 或特定的 MCP 扩展方式（如果支持）或仅在文本中包含结构化 JSON 块来实现。
*注：考虑到当前 MCP 实现，我们主要通过在返回文本中包含结构化信息，或者如果 MCP 支持 `metadata` 则使用 `metadata`。为简化，本阶段目标是确保返回的文本字符串中包含易于解析的 ID 信息，或者让工具内部维护的 Session Context 自动更新并可通过 `docx_get_context` 获取最新状态。*
*修正：根据项目惯例，我们更倾向于让工具直接返回 ID 字符串或 JSON 字符串。*

### R-004: 光标感知
当创建新元素时，自动更新 Session 中的光标位置到新元素之后，并在返回值中确认这一点。

## 3. 验收标准
1. `docx_add_paragraph` 返回包含 `paragraph_id` 的信息。
2. `docx_add_table` 返回 `table_id` 及首个单元格的 `cell_id`。
3. 连续调用场景测试：创建段落 -> 获取返回 ID -> 修改该段落，无需额外查找步骤。
