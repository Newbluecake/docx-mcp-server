---
feature: preview-path-config
complexity: standard
generated_by: clarify
generated_at: 2026-01-23T12:00:00Z
version: 1
---

# 需求文档: 预览路径配置功能

> **功能标识**: preview-path-config
> **复杂度**: standard
> **生成方式**: clarify
> **生成时间**: 2026-01-23

## 1. 概述

### 1.1 一句话描述
在 `docx-server-launcher` GUI 中添加手动配置 WPS 和 Word 可执行文件路径的功能，作为自动检测失败的兜底方案。

### 1.2 核心价值
解决部分用户因环境特殊（如绿色版 Office、自定义安装路径）导致自动检测失败，无法使用文档预览功能的问题。

### 1.3 目标用户
- **主要用户**：使用非标准安装路径 WPS/Word 的用户。
- **次要用户**：希望明确指定使用特定 Office 应用的用户。

---

## 2. 需求与用户故事

### 2.1 需求清单

| ID | 需求点 | 优先级 | 用户故事 |
|----|--------|--------|----------|
| R-001 | 手动配置路径 | P0 | As a 用户, I want 能手动选择 WPS/Word 路径, so that 即使自动检测失败也能预览文档 |
| R-002 | 文件选择器 | P0 | As a 用户, I want 通过文件选择对话框选择 .exe 文件, so that 避免手动输入路径错误 |
| R-003 | 实时验证 | P1 | As a 用户, I want 选择路径后立即看到验证结果, so that 确认配置是否有效 |
| R-004 | 优先级控制 | P1 | As a 用户, I want 选择优先使用 WPS 还是 Word, so that 系统按我的偏好打开文档 |
| R-005 | 配置持久化 | P0 | As a 用户, I want 配置保存后下次启动生效, so that 不需要每次重新配置 |

### 2.2 验收标准

#### R-001/R-002: 手动配置与选择器
- **WHEN** 用户点击配置按钮, **THEN** 弹出文件选择对话框，仅显示 .exe 文件
- **WHEN** 用户选择文件, **THEN** 路径显示在输入框中

#### R-003: 实时验证
- **WHEN** 路径发生变化, **THEN** 系统检查文件是否存在且可执行
- **WHEN** 验证通过, **THEN** 显示绿色对勾或成功提示
- **WHEN** 验证失败, **THEN** 显示红色警告或错误提示

#### R-004: 优先级控制
- **WHEN** 用户配置了 WPS 和 Word 路径, **THEN** 界面提供单选/下拉选项决定优先使用哪个
- **WHEN** 启动预览, **THEN** 系统优先尝试用户选择的应用，如果配置的路径无效则回退到自动检测

#### R-005: 配置持久化
- **WHEN** 关闭并重新打开 GUI, **THEN** 之前的配置和优先级选择保持不变
- **WHEN** 修改配置, **THEN** 配置文件（如 config.ini/json）同步更新

---

## 3. 功能验收清单

| ID | 功能点 | 验收步骤 | 优先级 | 关联需求 | 通过 |
|----|--------|----------|--------|----------|------|
| F-001 | WPS 路径配置 | 1. 点击选择按钮 2. 选择 wps.exe 3. 验证通过 | P0 | R-001 | ☐ |
| F-002 | Word 路径配置 | 1. 点击选择按钮 2. 选择 WINWORD.EXE 3. 验证通过 | P0 | R-001 | ☐ |
| F-003 | 优先级切换 | 1. 设置优先 WPS 2. 预览文档 -> WPS 打开 3. 切换优先 Word 4. 预览 -> Word 打开 | P1 | R-004 | ☐ |
| F-004 | 持久化验证 | 1. 配置路径并关闭应用 2. 重启应用 3. 路径依然存在 | P0 | R-005 | ☐ |

---

## 4. 技术约束

### 4.1 技术栈
- **GUI 框架**: 使用项目现有的 GUI 框架（可能是 PyQt/PySide 或 Tkinter，需确认现代码）
- **配置文件**: 复用现有的配置管理模块

### 4.2 集成点
- `docx-server-launcher`: 需要修改 UI 布局，添加配置区域
- `preview` 逻辑模块: 需要修改预览启动逻辑，读取配置路径

---

## 5. 排除项

- **其他 Office**: 仅支持 WPS 和 Word，暂不支持 LibreOffice 等。
- **命令行配置**: 仅提供 GUI 配置入口，不提供 CLI 参数配置。
- **Mac/Linux**: 仅针对 Windows 平台优化路径选择（.exe 过滤）。

---

## 6. 下一步

✅ 在新会话中执行：
```bash
/clouditera:dev:spec-dev preview-path-config --skip-requirements
```
